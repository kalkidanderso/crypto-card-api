# Deploy to Render (Free Tier)

## Prerequisites
- GitHub account
- Render account (sign up at https://render.com)

## Deployment Steps

### 1. Push Code to GitHub
```bash
# Initialize git (if not already done)
git init

# Add all files
git add .

# Commit
git commit -m "Initial commit - Crypto Card API"

# Create a new repository on GitHub, then:
git remote add origin https://github.com/YOUR_USERNAME/crypto-card-api.git
git branch -M main
git push -u origin main
```

### 2. Deploy on Render

#### Option A: Using Blueprint (Recommended)
1. Go to https://dashboard.render.com
2. Click **"New +"** → **"Blueprint"**
3. Connect your GitHub repository
4. Select the repository: `crypto-card-api`
5. Render will automatically detect `render.yaml`
6. Click **"Apply"** to deploy all services

#### Option B: Manual Setup
1. Create PostgreSQL database:
   - New + → PostgreSQL
   - Name: `crypto-card-postgres`
   - Database: `crypto_card_db`
   - Plan: Free

2. Create Redis instance:
   - New + → Private Service
   - Docker image: `redis:7-alpine`
   - Name: `crypto-card-redis`

3. Create Web Service:
   - New + → Web Service
   - Connect GitHub repo
   - Runtime: Docker
   - Add environment variables from render.yaml
   - Deploy

### 3. Access Your API

Once deployed, Render will provide a URL like:
```
https://crypto-card-api.onrender.com
```

Your API will be available at:
```
https://crypto-card-api.onrender.com/api/v1/health
```

### 4. Test Deployed API

```bash
# Health check
curl https://YOUR_APP.onrender.com/api/v1/health

# Register user
curl -X POST https://YOUR_APP.onrender.com/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"demo@example.com","password":"Password123!","firstName":"Demo","lastName":"User"}'

# Login
curl -X POST https://YOUR_APP.onrender.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"demo@example.com","password":"Password123!"}'
```

## Important Notes

### Free Tier Limitations
- **Spin down after 15 minutes of inactivity** (first request after inactivity takes ~30-60 seconds)
- 750 hours/month per service
- PostgreSQL: 1GB storage, 1GB RAM
- Redis: Limited memory
- 512MB RAM for web service

### Keeping Service Active (Optional)
To prevent spin-down, you can:
1. Use a service like UptimeRobot (https://uptimerobot.com) to ping your API every 14 minutes
2. Set up a cron job to hit the health endpoint

### Environment Variables
All sensitive environment variables (JWT secrets, database passwords) are automatically generated by Render.

### Monitoring
- Check logs: Render Dashboard → Your Service → Logs
- Metrics: Available in Render Dashboard
- Swagger UI: `https://YOUR_APP.onrender.com/api/docs`

## Troubleshooting

### Build Fails
- Check Dockerfile is present
- Ensure all dependencies in package.json
- Review build logs in Render Dashboard

### Database Connection Issues
- Verify environment variables are set correctly
- Check PostgreSQL service is running
- Review DB_HOST points to Render's internal hostname

### Service Won't Start
- Check health endpoint returns 200
- Review application logs
- Verify PORT environment variable is 3000

## Cost Estimate
- **Total: $0/month** (using free tier)
- PostgreSQL: Free (1GB)
- Redis: Free
- Web Service: Free (with spin-down)

## Upgrade Options
If you need:
- No spin-down: Upgrade web service to $7/month
- More database storage: Upgrade PostgreSQL
- Persistent Redis: Use managed Redis from Render or Redis Cloud
